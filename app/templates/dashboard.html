{% extends "base.html" %}
{% from "partials/widget_base.html" import widget, placeholder_widget %}

{% block title %}Patient Dashboard - Med-Z1{% endblock %}

{% block content %}
<div class="dashboard">
    {% if patient %}
        <!-- Patient-specific dashboard with widgets -->
        <div class="dashboard-header">
            <h1 class="dashboard-header__title">Patient Dashboard</h1>
            <p class="dashboard-header__subtitle">
                Clinical summary for {{ patient.name_display }}
            </p>
        </div>

        <!-- Widget Grid -->
        <div class="dashboard-grid" id="dashboard-widgets">
            <!-- Demographics Widget (1x1 - Standard) -->
            <div class="widget widget--1x1"
                 id="widget-demographics"
                 hx-get="/api/dashboard/widget/demographics/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Vitals Widget (1x1 - Standard) -->
            <div class="widget widget--1x1"
                 id="widget-vitals"
                 hx-get="/api/patient/dashboard/widget/vitals/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Encounters Widget (1x1 - Standard) -->
            <div class="widget widget--1x1"
                 id="widget-encounters"
                 hx-get="/api/patient/dashboard/widget/encounters/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Allergies Widget (1x1 - Standard) -->
            <div class="widget widget--1x1"
                 id="widget-allergies"
                 hx-get="/api/patient/dashboard/widget/allergies/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Medications Widget (2x1 - Wide) -->
            <div class="widget widget--2x1"
                 id="widget-medications"
                 hx-get="/api/patient/dashboard/widget/medications/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Laboratory Results Widget (3x1 - Full Width) - Placeholder -->
            {{ placeholder_widget(
                size='3x1',
                icon='fa-solid fa-flask',
                title='Laboratory Results',
                description='Recent lab panels with trends and sparklines'
            ) }}

            <!-- Problems/Diagnoses Widget (1x1 - Standard) - Placeholder -->
            {{ placeholder_widget(
                size='1x1',
                icon='fa-solid fa-stethoscope',
                title='Problems/Diagnoses',
                description='Active and historical diagnoses'
            ) }}

            <!-- Orders Widget (1x1 - Standard) - Placeholder -->
            {{ placeholder_widget(
                size='1x1',
                icon='fa-solid fa-clipboard-list',
                title='Orders',
                description='Recent and pending orders'
            ) }}

            <!-- Notes/Documents Widget (1x1 - Standard) - Placeholder -->
            {{ placeholder_widget(
                size='1x1',
                icon='fa-solid fa-file-lines',
                title='Notes/Documents',
                description='Clinical notes and documents'
            ) }}

            <!-- Radiology/Imaging Widget (1x1 - Standard) - Placeholder -->
            {{ placeholder_widget(
                size='1x1',
                icon='fa-solid fa-x-ray',
                title='Radiology/Imaging',
                description='Imaging studies and reports'
            ) }}

            <!-- Immunizations Widget (1x1 - Standard) - Placeholder -->
            {{ placeholder_widget(
                size='1x1',
                icon='fa-solid fa-syringe',
                title='Immunizations',
                description='Vaccination history and status'
            ) }}

            <!-- Procedures Widget (1x1 - Standard) - Placeholder -->
            {{ placeholder_widget(
                size='1x1',
                icon='fa-solid fa-user-doctor',
                title='Procedures',
                description='Surgical and procedural history'
            ) }}
        </div>

    {% else %}
        <!-- Empty State: No patient selected -->
        <div class="dashboard-empty">
            <div class="dashboard-empty__icon">
                <i class="fa-regular fa-user fa-4x"></i>
            </div>
            <h2 class="dashboard-empty__title">No Patient Selected</h2>
            <p class="dashboard-empty__message">
                Select a patient from the topbar to view their clinical summary
            </p>
            <button
                class="btn btn--primary"
                data-modal-open="patient-search-modal"
                aria-label="Open patient search"
            >
                <i class="fa-solid fa-magnifying-glass"></i>
                Select Patient
            </button>
        </div>
    {% endif %}

    {% if error %}
        <!-- Error state (if any) -->
        <div class="dashboard-error">
            <p class="text-danger">
                <i class="fa-solid fa-triangle-exclamation"></i>
                Error loading dashboard: {{ error }}
            </p>
        </div>
    {% endif %}
</div>
{% endblock %}
