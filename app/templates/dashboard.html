{% extends "base.html" %}
{% from "partials/widget_base.html" import widget, placeholder_widget %}

{% block title %}Patient Dashboard - Med-Z1{% endblock %}

{% block content %}
<div class="dashboard">
    {% if patient %}
        <!-- Patient-specific dashboard with widgets -->
        <div class="dashboard-header">
            <h1 class="dashboard-header__title">Patient Dashboard</h1>
        </div>

        <!-- Widget Grid -->
        <div class="dashboard-grid" id="dashboard-widgets">
            <!-- Row 1: Demographics + My Active Tasks -->
            <!-- Demographics Widget (1x1 - Standard) -->
            <div class="widget widget--1x1"
                 id="widget-demographics"
                 hx-get="/api/dashboard/widget/demographics/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Clinical Tasks Widget (2x1 - Wide) -->
            <div class="widget widget--2x1"
                 id="widget-tasks"
                 hx-get="/api/patient/dashboard/widget/tasks/{{ patient.icn }}"
                 hx-trigger="load, taskUpdated from:body"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Row 2: Vital Signs + Allergies + History -->
            <!-- Vitals Widget (1x1 - Standard) -->
            <div class="widget widget--1x1"
                 id="widget-vitals"
                 hx-get="/api/patient/dashboard/widget/vitals/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Allergies Widget (1x1 - Standard) -->
            <div class="widget widget--1x1"
                 id="widget-allergies"
                 hx-get="/api/patient/dashboard/widget/allergies/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- History Widget (1x1 - Standard) -->
            <div class="widget widget--1x1"
                 id="widget-history"
                 hx-get="/api/patient/dashboard/widget/history/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Row 3: Medications + Immunizations -->
            <!-- Medications Widget (2x1 - Wide) -->
            <div class="widget widget--2x1"
                 id="widget-medications"
                 hx-get="/api/patient/dashboard/widget/medications/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Immunizations Widget (1x1 - Standard) -->
            <div class="widget widget--1x1"
                 id="widget-immunizations"
                 hx-get="/api/patient/dashboard/widget/immunizations/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Row 4: Laboratory Results -->
            <!-- Laboratory Results Widget (3x1 - Full Width) -->
            <div class="widget widget--3x1"
                 id="widget-labs"
                 hx-get="/api/patient/dashboard/widget/labs/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Row 5: Clinical Notes + Encounters -->
            <!-- Clinical Notes Widget (2x1 - Wide) -->
            <div class="widget widget--2x1"
                 id="widget-notes"
                 hx-get="/api/patient/dashboard/widget/notes/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Encounters Widget (1x1 - Standard) -->
            <div class="widget widget--1x1"
                 id="widget-encounters"
                 hx-get="/api/patient/dashboard/widget/encounters/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__body">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Row 6: Orders + Procedures -->
            <!-- Orders Widget (1x1 - Standard) - Placeholder -->
            {{ placeholder_widget(
                size='1x1',
                icon='fa-solid fa-clipboard-list',
                title='Orders',
                description='Recent and pending orders'
            ) }}

            <!-- Procedures Widget (2x1 - Wide) - Placeholder -->
            {{ placeholder_widget(
                size='2x1',
                icon='fa-solid fa-user-doctor',
                title='Procedures',
                description='Surgical and procedural history'
            ) }}

            <!-- Row 7: Problems/Diagnoses -->
            <!-- Problems/Diagnoses Widget (2x1 - Wide) -->
            <div class="widget widget--2x1"
                 hx-get="/api/patient/dashboard/widget/problems/{{ patient.icn }}"
                 hx-trigger="load"
                 hx-swap="innerHTML">
                <div class="widget__loading">
                    <div class="widget__spinner"></div>
                </div>
            </div>

            <!-- Row 8: Radiology/Imaging -->
            <!-- Radiology/Imaging Widget (1x1 - Standard) - Placeholder -->
            {{ placeholder_widget(
                size='1x1',
                icon='fa-solid fa-x-ray',
                title='Radiology/Imaging',
                description='Imaging studies and reports'
            ) }}
        </div>

    {% else %}
        <!-- Empty State: No patient selected -->
        <div class="dashboard-empty">
            <div class="dashboard-empty__icon">
                <i class="fa-regular fa-user fa-4x"></i>
            </div>
            <h2 class="dashboard-empty__title">No Patient Selected</h2>
            <p class="dashboard-empty__message">
                Select a patient from the topbar to view their clinical summary
            </p>
            <button
                class="btn btn--primary"
                data-modal-open="patient-search-modal"
                aria-label="Open patient search"
            >
                <i class="fa-solid fa-magnifying-glass"></i>
                Select Patient
            </button>
        </div>
    {% endif %}

    {% if error %}
        <!-- Error state (if any) -->
        <div class="dashboard-error">
            <p class="text-danger">
                <i class="fa-solid fa-triangle-exclamation"></i>
                Error loading dashboard: {{ error }}
            </p>
        </div>
    {% endif %}
</div>
{% endblock %}
