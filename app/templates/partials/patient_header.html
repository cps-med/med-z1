<!-- app/templates/partials/patient_header.html -->

{% if patient %}
<div class="patient-header patient-header--active">
    <h1 class="patient-header__title">
        {{ patient.name_display }} ({{ patient.sex }}, {{ patient.age }})
    </h1>
    <p class="patient-header__subtitle">
        ICN: {{ patient.icn }} |
        SSN: ***-**-{{ patient.ssn_last4 }} |
        DOB: {{ patient.dob }} |
        Station: {{ patient.primary_station }}
        {% if patient.primary_station_name %}
        ({{ patient.primary_station_name }})
        {% endif %}
    </p>
</div>
<!-- Note: patient.icn may be "ICN100001" or "1016V123456" format -->

<script>
    // Enable/update patient flags button
    document.getElementById('btn-patient-flags').disabled = false;

    // Fetch flag count and update badge (Phase 3 placeholder)
    fetch('/api/patient/{{ patient.icn }}/flags')
        .then(r => r.json())
        .then(data => {
            const badge = document.getElementById('flags-badge');
            if (data.count > 0) {
                badge.textContent = data.count;
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        })
        .catch(err => console.error('Failed to load flag count:', err));
</script>

{% else %}
<div class="patient-header patient-header--empty">
    <h1 class="patient-header__title">
        No patient selected
    </h1>
    <p class="patient-header__subtitle">
        Click 'Select Patient' to begin
    </p>
</div>

<script>
    // Disable patient flags button
    document.getElementById('btn-patient-flags').disabled = true;
    document.getElementById('flags-badge').style.display = 'none';
</script>
{% endif %}
