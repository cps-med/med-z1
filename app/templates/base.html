<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Med Dashboard{% endblock %}</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://kit.fontawesome.com/124182fb50.css" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" href="/static/images/favicon-msu.ico">

    <!-- HTMX -->
    <!-- The /timer link did not work properly with v2.x, so sticking with 1.9.12  -->
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
</head>
<body>
<div class="layout">

    <aside class="sidebar">
        <!-- <div class="sidebar__inner"> -->
            <div class="sidebar__brand">
                <div class="sidebar__logo">med</div>
                <div class="sidebar__brand-text">
                    <span class="brand-name">Med Dashboard</span>
                    <span class="brand-subtitle">Python · FastAPI · HTMX</span>
                </div>
            </div>

            <nav class="sidebar__nav">
                <a href="/" 
                   class="sidebar__link {{ 'sidebar__link--active' if active_page == 'overview' else '' }}"
                   data-tooltip="Overview">
                    <i class="fa-regular fa-chart-column fa-lg"></i>
                    <span class="sidebar__text">Overview</span>
                </a>
                <a href="/htmx" 
                   class="sidebar__link {{ 'sidebar__link--active' if active_page == 'htmx' else '' }}"
                   data-tooltip="htmx">
                   <i class="fa-solid fa-code fa-lg"></i>
                    <span class="sidebar__text">htmx</span>
                </a>
                <a href="/timer" 
                   class="sidebar__link {{ 'sidebar__link--active' if active_page == 'timer' else '' }}"
                   data-tooltip="Timer">
                    <i class="fa-sharp fa-regular fa-timer fa-lg"></i>
                    <span class="sidebar__text">Timer</span>
                </a>
                <a href="#" class="sidebar__link" data-tooltip="Datasets">
                    <i class="fa-regular fa-cabinet-filing fa-lg"></i>
                    <span class="sidebar__text">Datasets</span>
                </a>
                <a href="#" class="sidebar__link" data-tooltip="Alerts">
                    <i class="fa-regular fa-bell fa-lg"></i>
                    <span class="sidebar__text">Alerts</span>
                </a>
                <a href="#" class="sidebar__link" data-tooltip="Settings">
                    <i class="fa-regular fa-gear fa-lg"></i>
                    <span class="sidebar__text">Settings</span>
                </a>
            </nav>

            <div class="sidebar__footer">
                <span class="sidebar__user-label">Signed in as</span>
                <span class="sidebar__user-name">csylvester</span>
            </div>

        </aside>

    <div class="main">
        <header class="topbar">
            <div class="topbar__left">
                <button
                    class="btn btn--icon"
                    type="button"
                    data-toggle-sidebar
                    aria-label="Toggle sidebar"
                >
                    ☰
                </button>

                <!-- HTMX-powered patient header partial -->
                <div
                    id="patient-header-container"
                    hx-get="/api/patient/current"
                    hx-trigger="load"
                    hx-swap="innerHTML"
                >
                    <!-- Initial loading state -->
                    <div class="patient-header">
                        <div class="patient-header__title">Loading patient context...</div>
                    </div>
                </div>
            </div>

            <div class="topbar__right">
                <button
                    id="btn-patient-flags"
                    class="btn btn--secondary"
                    data-modal-open="patient-flags-modal"
                    disabled
                    title="View patient flags (Phase 3)"
                >
                    <i class="fa-regular fa-flag"></i>
                    View Flags
                    <span id="flags-badge" class="badge badge--warning" style="display:none;">0</span>
                </button>

                <button
                    id="btn-select-patient"
                    class="btn btn--primary"
                    data-modal-open="patient-search-modal"
                >
                    <i class="fa-regular fa-user"></i>
                    Select Patient
                </button>

                <button
                    id="btn-refresh-patient"
                    class="btn btn--secondary"
                    hx-get="/api/patient/refresh"
                    hx-target="#patient-header-container"
                    hx-swap="innerHTML"
                    title="Refresh patient context from CCOW vault"
                >
                    <i class="fa-regular fa-refresh"></i>
                    Refresh Context
                </button>
            </div>
        </header>

        <!-- Page content -->
        <main class="content">
            {% block content %}{% endblock %}
        </main>

        <!-- Optional per-page scripts -->
        {% block scripts %}{% endblock %}
    </div>
</div>

<!-- Custom JavaScript -->
<script src="/static/app.js"></script>

<!-- Patient modals -->
{% include "partials/patient_search_modal.html" %}
{% include "partials/patient_flags_modal.html" %}

</body>
</html>
