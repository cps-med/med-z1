<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Med Dashboard{% endblock %}</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://kit.fontawesome.com/124182fb50.css" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" href="/static/images/favicon-msu.ico">

    <!-- HTMX -->
    <!-- The /timer link did not work properly with v2.x, so sticking with 1.9.12  -->
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>

    <!-- Prevent sidebar FOUC: Apply saved state before page renders -->
    <script>
        (function() {
            const savedState = localStorage.getItem('med-z1-sidebar-collapsed');
            if (savedState === 'true') {
                // Add class to html element temporarily
                document.documentElement.classList.add('sidebar-init-collapsed');
            }
        })();
    </script>
</head>
<body>
<div class="layout">

    <aside class="sidebar">
        <!-- <div class="sidebar__inner"> -->
            <div class="sidebar__brand">
                <div class="sidebar__logo">med</div>
                <div class="sidebar__brand-text">
                    <span class="brand-name">Med Dashboard</span>
                    <span class="brand-subtitle">Python · FastAPI · HTMX</span>
                </div>
            </div>

            <nav class="sidebar__nav">
                <!-- Dashboard -->
                <a href="/"
                   class="sidebar__link sidebar__link--section-end {{ 'sidebar__link--active' if active_page == 'dashboard' else '' }}"
                   data-tooltip="Dashboard">
                    <i class="fa-solid fa-house fa-lg"></i>
                    <span class="sidebar__text">Dashboard</span>
                </a>

                <!-- Clinical Domains (in dashboard widget order) -->
                <a href="/demographics"
                   class="sidebar__link {{ 'sidebar__link--active' if active_page == 'demographics' else '' }}"
                   data-tooltip="Patient Demographics">
                    <i class="fa-solid fa-user fa-lg"></i>
                    <span class="sidebar__text">Demographics</span>
                </a>
                <a href="/vitals"
                   class="sidebar__link {{ 'sidebar__link--active' if active_page == 'vitals' else '' }}"
                   data-tooltip="Patient Vital Signs">
                    <i class="fa-solid fa-heart-pulse fa-lg"></i>
                    <span class="sidebar__text">Vitals</span>
                </a>
                <a href="/encounters"
                   class="sidebar__link {{ 'sidebar__link--active' if active_page == 'encounters' else '' }}"
                   data-tooltip="Inpatient Encounters">
                    <i class="fa-solid fa-hospital fa-lg"></i>
                    <span class="sidebar__text">Encounters</span>
                </a>
                <a href="/allergies"
                   class="sidebar__link {{ 'sidebar__link--active' if active_page == 'allergies' else '' }}"
                   data-tooltip="Patient Allergies">
                    <i class="fa-solid fa-capsules fa-lg"></i>
                    <span class="sidebar__text">Allergies</span>
                </a>
                <a href="/medications"
                   class="sidebar__link {% if active_page == 'medications' %}sidebar__link--active{% endif %}"
                   data-tooltip="Patient Medications">
                    <i class="fa-solid fa-pills fa-lg"></i>
                    <span class="sidebar__text">Medications</span>
                </a>
                <a href="/labs"
                   class="sidebar__link {{ 'sidebar__link--active' if active_page == 'labs' else '' }}"
                   data-tooltip="Laboratory Results">
                    <i class="fa-solid fa-flask-vial fa-lg"></i>
                    <span class="sidebar__text">Labs</span>
                </a>
                <a href="#"
                   class="sidebar__link sidebar__link--disabled"
                   data-tooltip="Problems/Diagnoses (Coming Soon)">
                    <i class="fa-solid fa-stethoscope fa-lg"></i>
                    <span class="sidebar__text">Problems</span>
                </a>
                <a href="#"
                   class="sidebar__link sidebar__link--disabled"
                   data-tooltip="Orders (Coming Soon)">
                    <i class="fa-solid fa-clipboard-list fa-lg"></i>
                    <span class="sidebar__text">Orders</span>
                </a>
                <a href="#"
                   class="sidebar__link sidebar__link--disabled"
                   data-tooltip="Notes/Documents (Coming Soon)">
                    <i class="fa-solid fa-file-lines fa-lg"></i>
                    <span class="sidebar__text">Notes</span>
                </a>
                <a href="#"
                   class="sidebar__link sidebar__link--disabled"
                   data-tooltip="Radiology/Imaging (Coming Soon)">
                    <i class="fa-solid fa-x-ray fa-lg"></i>
                    <span class="sidebar__text">Imaging</span>
                </a>
                <a href="#"
                   class="sidebar__link sidebar__link--disabled"
                   data-tooltip="Immunizations (Coming Soon)">
                    <i class="fa-solid fa-syringe fa-lg"></i>
                    <span class="sidebar__text">Immunizations</span>
                </a>
                <a href="#"
                   class="sidebar__link sidebar__link--disabled"
                   data-tooltip="Procedures (Coming Soon)">
                    <i class="fa-solid fa-user-doctor fa-lg"></i>
                    <span class="sidebar__text">Procedures</span>
                </a>
            </nav>

            <div class="sidebar__footer">
                <span class="sidebar__user-label">Signed in as</span>
                <span class="sidebar__user-name">csylvester</span>
            </div>

        </aside>

    <div class="main">
        <header class="topbar">
            <div class="topbar__left">
                <button
                    class="btn btn--icon"
                    type="button"
                    data-toggle-sidebar
                    aria-label="Toggle sidebar"
                >
                    ☰
                </button>

                <!-- HTMX-powered patient header partial -->
                <div
                    id="patient-header-container"
                    hx-get="/api/patient/current"
                    hx-trigger="load"
                    hx-swap="innerHTML"
                >
                    <!-- Initial loading state -->
                    <div class="patient-header">
                        <div class="patient-header__title">Loading patient context...</div>
                    </div>
                </div>
            </div>

            <div class="topbar__right">
                <button
                    id="btn-patient-flags"
                    class="btn btn--secondary"
                    data-modal-open="patient-flags-modal"
                    disabled
                    title="View patient flags"
                >
                    <i class="fa-regular fa-flag"></i>
                    View Flags
                    <span id="flags-badge" class="badge badge--warning" style="display:none;">0</span>
                </button>

                <button
                    id="btn-select-patient"
                    class="btn btn--primary"
                    data-modal-open="patient-search-modal"
                >
                    <i class="fa-regular fa-user"></i>
                    Select Patient
                </button>

                <button
                    id="btn-refresh-patient"
                    class="btn btn--secondary"
                    hx-get="/api/patient/refresh"
                    hx-target="#patient-header-container"
                    hx-swap="innerHTML"
                    title="Refresh patient context from CCOW vault"
                >
                    <i class="fa-regular fa-refresh"></i>
                    Refresh Context
                </button>
            </div>
        </header>

        <!-- Page content -->
        <main class="content">
            {% block content %}{% endblock %}
        </main>

        <!-- Optional per-page scripts -->
        {% block scripts %}{% endblock %}
    </div>
</div>

<!-- Custom JavaScript -->
<script src="/static/app.js"></script>

<!-- Patient modals -->
{% include "partials/patient_search_modal.html" %}
{% include "partials/patient_flags_modal.html" %}

</body>
</html>
